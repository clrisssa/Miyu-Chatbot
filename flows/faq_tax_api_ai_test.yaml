name: faq_tax_api_ai_test
states:
    stop_schedule_state:
        component: meya.schedule_stop
        properties:
            tag: schedule
    
    component_state:
        component: faq_tax
    
    #checks if tax resident is mentioned in the argument already
    
    # test_state:
    #     component: meya.text
    #     properties:
    #         text: "{{flow.is_tax_resident}}"

    exist_check_state:
        component: meya.conditional_exists
        properties:
            scope: flow
            key: is_tax_resident
        transitions:
            exists: equal_check_state
            notexists: state
            
    #ask if the user has not mentioned tax resident in the argument

    state:
        component: meya.nlp_yes_no
        properties:
            text: Are you a Singapore tax resident?
        transitions:
            "yes": input_yes
            "no": input_no
        delay:
            relative: 1
            
    input_yes:
        component: input_is_tax_resident_true
        transitions:
            next: equal_check_state
    
    input_no:
        component: input_is_tax_resident_false
        transitions:
            next: equal_check_state
    
    #checks truthy value of is_tax_resident

    equal_check_state:
        component: meya.conditional_equal
        properties:
            value1: '{{ flow.is_tax_resident }}'
            value2: 'true'
        transitions:
            equal: is_singapore_tax
            notequal: not_singapore_tax
        
    
    #sg tax resident, check if user 
    
    
    is_singapore_tax:
        component: meya.conditional_exists
        properties:
            scope: user
            key: email
        transitions:
            exists: is_user_singapore_tax
            notexists: is_non_user_singapore_tax
        delay:
            relative: 3
    #not sg tax resident, check if user
    not_singapore_tax:
        component: meya.conditional_exists
        properties:
            scope: user
            key: email
        transitions:
            exists: is_user_not_singapore_tax
            notexists: is_non_user_not_singapore_tax
        delay:
            relative: 3
    #answers for users
    is_user_singapore_tax:
        component: meya.text
        properties:
            text: According to Inland Revenue Authority of Singapore (IRAS), interest income from loans to companies are taxable at progressive tax rates for Singapore tax residents. You must declare the interest income earned in the financial year, less any service fees.
        delay:
            relative: 2
    is_user_singapore_tax2:
        component: meya.text
        properties:
            text: Read this help centre article for more info, https://intercom.help/funding-societies/investing-with-funding-societies/tax
        transitions:
            next: anything_else_schedule

    is_user_not_singapore_tax:
        component: meya.text
        properties:
            text: Non-Singapore tax residents are subjected to withholding tax, which is 15% of interest earned, nett service fees.
        delay:
            relative: 2
    is_user_not_singapore_tax2:
        component: meya.text
        properties:
            text: You can find out more from this help centre article, https://intercom.help/funding-societies/investing-with-funding-societies/withholding-tax-explained
        transitions:
            next: anything_else_schedule

    #answers for non users
    is_non_user_singapore_tax:
        component: meya.text
        properties:
            text: >
                According to Inland Revenue Authority of Singapore (IRAS), interest income from loans to companies are taxable at progressive tax rates for Singapore tax residents. 
                You must declare the interest income earned in the financial year, less any service fees.
        transitions:
            next: anything_else_schedule        

    is_non_user_not_singapore_tax:
        component: meya.text
        properties:
            text: Non-Singapore tax residents are subjected to withholding tax, which is 15% of interest earned, nett service fees.
        transitions:
            next: anything_else_schedule

    anything_else_schedule:
        flow: anything_else_schedule